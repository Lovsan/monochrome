<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>navigation_chapter.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Blacklist.html">Blacklist</a><ul class='methods'><li data-type='method'><a href="Blacklist.html#blacklistUser">blacklistUser</a></li><li data-type='method'><a href="Blacklist.html#isUserBlacklisted">isUserBlacklisted</a></li><li data-type='method'><a href="Blacklist.html#isUserBlacklistedQuick">isUserBlacklistedQuick</a></li><li data-type='method'><a href="Blacklist.html#unblacklistUser">unblacklistUser</a></li></ul></li><li><a href="Command.html">Command</a></li><li><a href="CommandManager.html">CommandManager</a><ul class='methods'><li data-type='method'><a href="CommandManager.html#getHelpCommandHelper">getHelpCommandHelper</a></li></ul></li><li><a href="HelpCommandHelper.html">HelpCommandHelper</a><ul class='methods'><li data-type='method'><a href="HelpCommandHelper.html#findCommand">findCommand</a></li><li data-type='method'><a href="HelpCommandHelper.html#getEnabledNonHiddenCommands">getEnabledNonHiddenCommands</a></li><li data-type='method'><a href="HelpCommandHelper.html#getNonHiddenCommands">getNonHiddenCommands</a></li></ul></li><li><a href="Logger.html">Logger</a><ul class='methods'><li data-type='method'><a href="Logger.html#logFailure">logFailure</a></li><li data-type='method'><a href="Logger.html#logSuccess">logSuccess</a></li></ul></li><li><a href="MessageProcessor.html">MessageProcessor</a></li><li><a href="Monochrome.html">Monochrome</a><ul class='methods'><li data-type='method'><a href="Monochrome.html#connect">connect</a></li><li data-type='method'><a href="Monochrome.html#getBlacklist">getBlacklist</a></li><li data-type='method'><a href="Monochrome.html#getCommandManager">getCommandManager</a></li><li data-type='method'><a href="Monochrome.html#getErisBot">getErisBot</a></li><li data-type='method'><a href="Monochrome.html#getLogger">getLogger</a></li><li data-type='method'><a href="Monochrome.html#getNavigationManager">getNavigationManager</a></li><li data-type='method'><a href="Monochrome.html#getPersistence">getPersistence</a></li><li data-type='method'><a href="Monochrome.html#getSettings">getSettings</a></li><li data-type='method'><a href="Monochrome.html#reload">reload</a></li><li data-type='method'><a href="Monochrome.html#stop">stop</a></li><li data-type='method'><a href="Monochrome.html#userIsServerAdmin">userIsServerAdmin</a></li><li data-type='method'><a href="Monochrome.html#waitForMessage">waitForMessage</a></li></ul></li><li><a href="Navigation.html">Navigation</a><ul class='methods'><li data-type='method'><a href="Navigation.html#.fromOneDimensionalContents">fromOneDimensionalContents</a></li><li data-type='method'><a href="Navigation.html#.fromOneNavigationChapter">fromOneNavigationChapter</a></li></ul></li><li><a href="NavigationChapter.html">NavigationChapter</a><ul class='methods'><li data-type='method'><a href="NavigationChapter.html#.fromContent">fromContent</a></li></ul></li><li><a href="NavigationManager.html">NavigationManager</a><ul class='methods'><li data-type='method'><a href="NavigationManager.html#show">show</a></li></ul></li><li><a href="Persistence.html">Persistence</a><ul class='methods'><li data-type='method'><a href="Persistence.html#editData">editData</a></li><li data-type='method'><a href="Persistence.html#editDataForServer">editDataForServer</a></li><li data-type='method'><a href="Persistence.html#editDataForUser">editDataForUser</a></li><li data-type='method'><a href="Persistence.html#editGlobalData">editGlobalData</a></li><li data-type='method'><a href="Persistence.html#editPrefixesForServerId">editPrefixesForServerId</a></li><li data-type='method'><a href="Persistence.html#getData">getData</a></li><li data-type='method'><a href="Persistence.html#getDataForServer">getDataForServer</a></li><li data-type='method'><a href="Persistence.html#getDataForUser">getDataForUser</a></li><li data-type='method'><a href="Persistence.html#getGlobalData">getGlobalData</a></li><li data-type='method'><a href="Persistence.html#getPrefixesForMessage">getPrefixesForMessage</a></li><li data-type='method'><a href="Persistence.html#getPrefixesForServer">getPrefixesForServer</a></li><li data-type='method'><a href="Persistence.html#getPrimaryPrefixForMessage">getPrimaryPrefixForMessage</a></li><li data-type='method'><a href="Persistence.html#resetPrefixesForServerId">resetPrefixesForServerId</a></li><li data-type='method'><a href="Persistence.html#stop">stop</a></li></ul></li><li><a href="Settings.html">Settings</a><ul class='methods'><li data-type='method'><a href="Settings.html#getInternalSettingValue">getInternalSettingValue</a></li><li data-type='method'><a href="Settings.html#getRawSettingsTree">getRawSettingsTree</a></li><li data-type='method'><a href="Settings.html#getTreeNodeForUniqueId">getTreeNodeForUniqueId</a></li><li data-type='method'><a href="Settings.html#getUserFacingSettingValue">getUserFacingSettingValue</a></li><li data-type='method'><a href="Settings.html#setChannelSettingValue">setChannelSettingValue</a></li><li data-type='method'><a href="Settings.html#setServerWideSettingValue">setServerWideSettingValue</a></li><li data-type='method'><a href="Settings.html#setUserSettingValue">setUserSettingValue</a></li><li data-type='method'><a href="Settings.html#userFacingValueIsValidForSetting">userFacingValueIsValidForSetting</a></li></ul></li></ul><h3>Externals</h3><ul><li><a href="external-_Eris.Client_.html">Eris.Client</a></li><li><a href="external-_Eris.Message_.html">Eris.Message</a></li><li><a href="external-_Eris.TextChannel_.html">Eris.TextChannel</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">navigation_chapter.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const LOGGER_TITLE = 'NAVIGATION';

/**
 * This function is called when the user first navigates to this navigation chapter.
 * If you need to, for example, make an HTTP request to an API that does not support pagination,
 * you should do so here and return the result. If the API does support pagination, you can make
 * the requests page-by-page in {@link NavigationChapter~getPageFromPreparedData} instead.
 * This function will only be called once, when the user first navigates to this navigation chapter.
 * @callback NavigationChapter~prepareData
 * @returns {Object} The prepared data that will later be passed into {@link NavigationChapter~getPageFromPreparedData}. You can
 *   return anything or nothing.
 * @async
 */

 /**
  * This function is called when the user navigates to a page of the navigation chapter that they
  * have not yet navigated to. This function should return the Discord message content for that page.
  * This function is only called once. If the user navigates away and back to the page with the specified pageIndex,
  * the {@link NavigationManager} replies with cached message content rather than calling this function again.
  * @callback NavigationChapter~getPageFromPreparedData
  * @param {Object} preparedData - Whatever was returned from the {@link NavigationChapter~prepareData} function.
  * @param {number} pageIndex - The index of the page to return.
  * @returns {(Object|string|undefined)} - A string or [Discord embed structure]{@link https://discordapp.com/developers/docs/resources/channel#embed-object} representing
  *   the content to update the message with when the user navigates to the specified pageIndex. If the pageIndex is out of bounds, you can return undefined, and no
  *   navigation will occur.
  * @async
  */

/**
 * An object that lazily fetches the necessary data and converts it into Discord content structures.
 * @typedef {Object} NavigationChapter~dataSource
 * @property {NavigationChapter~prepareData} prepareData - A function to prepare the data to be displayed by this navigation chapter.
 * @property {NavigationChapter~getPageFromPreparedData} getPageFromPreparedData - A function to extract the current page from the prepared data.
 */


/**
 * Represents a one dimensional slice of navigable data.
 * If you create a navigation that uses emojis A, B, and C,
 * each of those is controlled by one NavigationChapter.
 * The navigation chapter controls what the user sees when they
 * use the arrow reaction buttons below the message to navigate forward
 * and backward within a chapter. Using other reaction buttons
 * switches to the NavigationChapter associated with that reaction.
 * A NavigationChapter is a sub-unit of a {@link Navigation}.
 * For more information about what a Navigation is, see {@link Navigation}.
 * For an example of creating a navigation, see the [demo navigation command]{@link https://github.com/mistval/monochrome-demo/blob/master/commands/navigation.js}.
 */
class NavigationChapter {
  /**
   * Construct a navigation chapter. If you already have all the information you
   * want to send as a navigable Discord message, use the {@link NavigationChapter.fromContent}
   * factory method instead.
   * @param {NavigationChapter~dataSource} dataSource - The datasource that fetches the information to show as a navigable Discord message.
   */
  constructor(dataSource) {
    this.dataSource_ = dataSource;
    this.pages_ = [];
    this.currentPageIndex_ = 0;
  }

  /**
   * Create a navigation chapter using already-known message content.
   * @param {(string[]|Object[])} contents - An array of message objects.
   *   They can either be strings, or they can be [Discord embed structures]{@link https://discordapp.com/developers/docs/resources/channel#embed-object}.
   *   Each element in this array represents one Discord message. The user can use the arrow reaction buttons displayed below
   *   the message to show the next or previous message in this array.
   */
  static fromContent(contents) {
    let dataSource = {};
    dataSource.prepareData = () => {
      return contents;
    };
    dataSource.getPageFromPreparedData = (preparedData, pageIndex) => {
      return preparedData[pageIndex];
    };
    let chapter = new NavigationChapter(dataSource);
    return chapter;
  }

  async getCurrentPage(logger) {
    if (!this.preparedData_) {
      try {
        this.preparedData_ = await this.dataSource_.prepareData();
        if (this.preparedData_ === undefined) {
          this.preparedData_ = true;
        }
        return this.getCurrentPageFromPreparedData_(logger);
      } catch (err) {
        logger.logFailure(LOGGER_TITLE, 'Error preparing data for navigation.', err);
        throw err;
      }
    } else {
      return this.getCurrentPageFromPreparedData_(logger);
    }
  }

  flipToPreviousPage(logger) {
    if (this.currentPageIndex_ > 0) {
      --this.currentPageIndex_;
      return this.getCurrentPage(logger);
    }
    return Promise.resolve(undefined);
  }

  flipToNextPage(logger) {
    ++this.currentPageIndex_;
    return this.getCurrentPage(logger);
  }

  async getCurrentPageFromPreparedData_(logger) {
    let pageToGet = this.currentPageIndex_;
    if (this.pages_[pageToGet]) {
      return this.pages_[pageToGet];
    } else {
      try {
        let page = await this.dataSource_.getPageFromPreparedData(this.preparedData_, pageToGet);
        while (this.pages_.length &lt;= pageToGet) {
          this.pages_.push(undefined);
        }
        if (!this.pages_[pageToGet]) {
          this.pages_[pageToGet] = page;
        }
        if (page) {
          return page;
        } else {
          this.pages_[pageToGet] = undefined;
          await this.flipToPreviousPage(logger);
          return undefined;
        }
      } catch (err) {
        logger.logFailure(LOGGER_TITLE, 'Error getting navigation page from prepared data.', err);
        await this.flipToPreviousPage(logger);
        return undefined;
      }
    }
  }
}

module.exports = NavigationChapter;
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Jan 28 2019 00:19:06 GMT+0700 (GMT+07:00) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>


</body>
</html>
